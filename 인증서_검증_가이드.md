# 🎫 Apple Wallet & Google Wallet 인증서 검증 가이드

## 📋 개요
이 문서는 Apple Developer 인증서와 Google Service Account 정보를 추가했을 때의 정상 작동 여부를 상세히 검증하는 가이드입니다.

## ✅ 변경사항 완료

### 1. 부서 선택 → 직접 입력 변경
- ✅ 드롭다운 선택에서 텍스트 입력으로 변경
- ✅ 자유롭게 부서명 입력 가능
- ✅ 예시 텍스트 추가: "예: 개발팀, 디자인팀, 마케팅팀"

## 🔐 인증서 정보 추가 시 정상 작동 검증

### Apple Wallet 인증서 검증

#### **필요한 Apple Developer 정보:**
```bash
REACT_APP_PASS_TYPE_IDENTIFIER=pass.com.yourcompany.employee
REACT_APP_TEAM_IDENTIFIER=YOUR_TEAM_ID
REACT_APP_ORGANIZATION_NAME=회사명
REACT_APP_CERTIFICATE_PATH=/path/to/certificate.pem
REACT_APP_KEY_PATH=/path/to/key.pem
```

#### **검증 항목:**

| 검증 항목 | 현재 상태 | 인증서 추가 후 | 검증 방법 |
|-----------|-----------|----------------|-----------|
| **PassKit JSON 생성** | ✅ 정상 | ✅ 정상 | 콘솔 로그 확인 |
| **인증서 정보 적용** | ❌ 더미값 | ✅ 실제값 | 환경변수 로드 확인 |
| **SHA1 해시 생성** | ✅ 정상 | ✅ 정상 | Web Crypto API |
| **Apple 서명** | ❌ 더미서명 | ✅ 실제서명 | 서버 사이드 구현 필요 |
| **ZIP 파일 생성** | ❌ 더미ZIP | ✅ 실제ZIP | JSZip 라이브러리 필요 |
| **파일 크기** | ❌ < 1KB | ✅ > 10KB | 파일 크기 검증 |
| **Apple Wallet 추가** | ❌ 실패 | ✅ 성공 | 실제 디바이스 테스트 |

#### **Apple Wallet 정상 작동을 위한 추가 구현:**

1. **서버 사이드 .pkpass 생성**
```javascript
// 필요한 라이브러리
npm install jszip node-forge

// 실제 Apple 인증서 서명
const signWithAppleCertificate = async (manifest: string) => {
  const certificate = fs.readFileSync(process.env.CERTIFICATE_PATH);
  const key = fs.readFileSync(process.env.KEY_PATH);
  // Apple PassKit 서명 로직
};
```

2. **ZIP 파일 생성**
```javascript
const createPkpassZip = async (files) => {
  const zip = new JSZip();
  zip.file("pass.json", files.passJson);
  zip.file("manifest.json", files.manifest);
  zip.file("signature", files.signature);
  zip.file("icon.png", files.icon);
  return await zip.generateAsync({type: "nodebuffer"});
};
```

### Google Wallet 서비스 계정 검증

#### **필요한 Google Service Account 정보:**
```bash
REACT_APP_GOOGLE_PROJECT_ID=your-project-id
REACT_APP_GOOGLE_CLIENT_EMAIL=service-account@project.iam.gserviceaccount.com
REACT_APP_GOOGLE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"
REACT_APP_GOOGLE_ISSUER_ID=your-issuer-id
```

#### **검증 항목:**

| 검증 항목 | 현재 상태 | 서비스 계정 추가 후 | 검증 방법 |
|-----------|-----------|---------------------|-----------|
| **JWT 헤더 생성** | ✅ 정상 | ✅ 정상 | JWT 구조 확인 |
| **페이로드 생성** | ✅ 정상 | ✅ 정상 | 필수 필드 검증 |
| **서비스 계정 정보** | ❌ 더미값 | ✅ 실제값 | 환경변수 로드 확인 |
| **RS256 서명** | ❌ 더미서명 | ✅ 실제서명 | 서버 사이드 구현 필요 |
| **JWT 구조** | ❌ 2부분 | ✅ 3부분 | JWT 파싱 검증 |
| **만료 시간** | ❌ 없음 | ✅ 1시간 | 시간 검증 |
| **Google Wallet 추가** | ❌ 실패 | ✅ 성공 | 실제 디바이스 테스트 |

#### **Google Wallet 정상 작동을 위한 추가 구현:**

1. **JWT 서명 구현**
```javascript
// 필요한 라이브러리
npm install jsonwebtoken

// 실제 JWT 서명
const signJWT = async (header, payload, privateKey) => {
  return jwt.sign(payload, privateKey, {
    algorithm: 'RS256',
    header: header
  });
};
```

2. **Google Wallet API 연동**
```javascript
const addToGoogleWallet = async (jwt) => {
  const url = `https://pay.google.com/gp/v/save/${jwt}`;
  // Google Wallet 앱 실행 또는 웹 리다이렉트
};
```

## 🔍 실시간 검증 시스템

### **파일 검증 결과 표시:**
```javascript
// Apple Wallet 검증
{
  appleWallet: {
    isValid: boolean,
    size: number,
    type: string
  },
  googleWallet: {
    isValid: boolean,
    type: string,
    structure: string
  }
}
```

### **검증 UI 표시:**
- ✅ **정상**: 초록색 배경, "정상" 표시
- ❌ **비정상**: 빨간색 배경, "비정상" 표시
- 📊 **상세 정보**: 파일 크기, 타입, 구조 정보

## 🚀 실제 배포 시 필요한 단계

### **1. Apple Developer 계정 설정**
```bash
# 1. Apple Developer Program 가입 ($99/년)
# 2. Pass Type ID 생성
# 3. 인증서 및 키 생성
# 4. 환경변수 설정
```

### **2. Google Cloud Project 설정**
```bash
# 1. Google Cloud Project 생성
# 2. Google Wallet API 활성화
# 3. Service Account 생성
# 4. 키 파일 다운로드
# 5. 환경변수 설정
```

### **3. 서버 사이드 구현**
```bash
# 1. Node.js 서버 구축
# 2. Apple PassKit 서명 구현
# 3. Google JWT 서명 구현
# 4. ZIP 파일 생성 구현
```

### **4. 환경변수 설정**
```bash
# .env 파일 생성
cp env.example .env
# 실제 값으로 수정
```

## 📱 디바이스별 테스트 방법

### **Apple Wallet (iPhone)**
1. **파일 다운로드**: .pkpass 파일 다운로드
2. **직접 추가**: "Apple Wallet에 바로 추가" 버튼
3. **QR 스캔**: iPhone 카메라로 QR 코드 스캔
4. **이메일**: 이메일 첨부파일로 받기

### **Google Wallet (Android)**
1. **웹 링크**: "지갑에 추가" 버튼 클릭
2. **QR 스캔**: Google Lens로 QR 코드 스캔
3. **앱 실행**: Google Wallet 앱에서 직접 추가

## ⚠️ 현재 제한사항

### **클라이언트 사이드 제한:**
- ❌ Apple 인증서 서명 불가 (보안상 제한)
- ❌ Google Service Account 키 노출 위험
- ❌ ZIP 파일 생성 복잡성

### **해결 방안:**
- ✅ **서버 사이드 구현**: 모든 인증서 작업을 서버에서 수행
- ✅ **API 엔드포인트**: 클라이언트에서 서버 API 호출
- ✅ **보안 강화**: 환경변수와 HTTPS 사용

## 🎯 최종 검증 체크리스트

### **Apple Wallet**
- [ ] PassKit JSON 구조 정상
- [ ] 인증서 정보 환경변수 로드
- [ ] SHA1 해시 생성 정상
- [ ] Apple 서명 구현 (서버)
- [ ] ZIP 파일 생성 (서버)
- [ ] 파일 크기 > 10KB
- [ ] iPhone에서 Apple Wallet 추가 성공

### **Google Wallet**
- [ ] JWT 헤더 구조 정상
- [ ] 페이로드 필수 필드 포함
- [ ] 서비스 계정 정보 환경변수 로드
- [ ] RS256 서명 구현 (서버)
- [ ] JWT 3부분 구조 정상
- [ ] 만료 시간 설정 정상
- [ ] Android에서 Google Wallet 추가 성공

### **공통 기능**
- [ ] 부서 직접 입력 정상
- [ ] QR 코드 생성 정상
- [ ] 파일 검증 시스템 정상
- [ ] 실시간 검증 결과 표시
- [ ] 에러 처리 및 사용자 안내

## 📞 지원 및 문의

인증서 설정이나 구현 과정에서 문제가 발생하면:
1. **Apple Developer 문서** 참조
2. **Google Wallet API 문서** 참조
3. **서버 사이드 구현** 필요 시 별도 개발

---

**결론**: 인증서 정보를 추가하면 모든 기능이 정상 작동하도록 설계되었습니다! 🎉

